#pragma once

#define CEF_VERSION_1

#include "include/cef_client.h"

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#ifdef CEF_VERSION_1
#define WINDOW_HANDLE(B) B->GetWindowHandle()
#endif
#ifdef CEF_VERSION_3
#define WINDOW_HANDLE(B) B->GetHost()->GetWindowHandle()
#endif

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#pragma comment(lib, "libcef.lib")
#pragma comment(lib, "libcef_dll_wrapper.lib")

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#define REQUIRE_UI_THREAD()   ASSERT(CefCurrentlyOn(TID_UI));
#define REQUIRE_IO_THREAD()   ASSERT(CefCurrentlyOn(TID_IO));
#define REQUIRE_FILE_THREAD() ASSERT(CefCurrentlyOn(TID_FILE));

class CWebKitXCtrl;

/////////////////////////////////////////////////////////////////////////////////////////////////////
class WebKitHandler :
	public CefClient,
	public CefLifeSpanHandler
{
public:

	CWebKitXCtrl* control;

	WebKitHandler(CWebKitXCtrl* control);
	~WebKitHandler(void);

	/////////////////////////////////////////////////////////////////////////////////////////////////////
	// CefClient methods
	virtual CefRefPtr<CefLifeSpanHandler> GetLifeSpanHandler() OVERRIDE {	return this; } 

	/////////////////////////////////////////////////////////////////////////////////////////////////////
	// CefLifeSpanHandler methods
	virtual void OnAfterCreated(CefRefPtr<CefBrowser> browser) OVERRIDE;	
	virtual void OnBeforeClose(CefRefPtr<CefBrowser> browser) OVERRIDE;

	/////////////////////////////////////////////////////////////////////////////////////////////////////
	IMPLEMENT_REFCOUNTING(WebKitHandler);
	IMPLEMENT_LOCKING(WebKitHandler);		
};
