
#include "StdAfx.h"
#include "WebKitHandler.h"
#include "WebKitXCtrl.h"

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
WebKitHandler::WebKitHandler(CWebKitXCtrl* control)
{
	this->control = control;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
WebKitHandler::~WebKitHandler(void)
{
	this->control = NULL;	
	debugPrint("WebKitHandler terminated.\n");
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void WebKitHandler::OnAfterCreated(CefRefPtr<CefBrowser> browser) 
{
	REQUIRE_UI_THREAD();
	AutoLock lock_scope(this);
	if (!control->m_Browser.get())   
	{		
		control->m_Browser = browser;
		control->m_BrowserHwnd = WINDOW_HANDLE(browser);
	}
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void WebKitHandler::OnBeforeClose(CefRefPtr<CefBrowser> browser) 
{
	REQUIRE_UI_THREAD();
	if(control->m_BrowserHwnd == WINDOW_HANDLE(browser))
	{
		control->DestroyCEFBrowser();
	}	
}
